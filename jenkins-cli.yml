---
- hosts: new_jenkins
  become: true
  vars: 
    jenkins_url: http://localhost:8080
  tasks:
  - name: Download CLI jar
    get_url:
      url: http://localhost:8080/jnlpJars/jenkins-cli.jar
      dest: /opt/jenkins-cli.jar
      
  - name: Jenkins Initial Password
    shell: cat /var/lib/jenkins/secrets/initialAdminPassword
    changed_when: false
    register: init_password

  - name: New User
    shell: echo 'jenkins.model.Jenkins.instance.securityRealm.createAccount("admin", "admin")' | java -jar /opt/jenkins-cli.jar -s "{{ jenkins_url }}" -auth admin:"{{ init_password.stdout }}" -noKeyAuth groovy = â€“ 
